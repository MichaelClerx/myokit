#!/usr/bin/env python3
import myokit
import matplotlib.pyplot as plt
import numpy as np

m, p, _ = myokit.load('test.mmt')

#myokit.DEBUG = True

sensitivities=(
    ['membrane.V', 'ina.INa'],
    ['ina.gNa', 'ica.gCa', 'init(ica.Ca_i)']
)

b = myokit.Benchmarker()
s = myokit.Simulation(m, p, sensitivities)
print(b.time())
b.reset()
d, e = s.run(3000, log_interval=1)
e = np.array(e)
print(b.time())

print(e.shape)


plt.figure()
plt.subplot(3, 1, 1)
plt.plot(d.time(), d['membrane.V'])
plt.subplot(3, 3, 4)
plt.plot(d.time(), e[:, 0, 0], label='dV/dgNa')
plt.legend()
plt.subplot(3, 3, 5)
plt.plot(d.time(), e[:, 0, 1], label='dV/dgCa')
plt.legend()
plt.subplot(3, 3, 6)
plt.plot(d.time(), e[:, 0, 2], label='dV/dCai0')
plt.legend()
plt.subplot(3, 3, 7)
plt.plot(d.time(), e[:, 1, 0], label='dINa/dgNa')
plt.legend()
plt.subplot(3, 3, 8)
plt.plot(d.time(), e[:, 1, 1], label='dINa/dgCa')
plt.legend()
plt.subplot(3, 3, 9)
plt.plot(d.time(), e[:, 1, 2], label='dINa/dCai0')
plt.legend()


plt.show()

